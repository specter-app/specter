(function() {
  'use strict';
  var heatmapService = function() {
    var visited = {};
    var dataPoints = { fakestache: [
      {location: new google.maps.LatLng(37.782551, -122.445368), weight: 0.1},
      {location: new google.maps.LatLng(37.782745, -122.444586), weight: 0.5},
      {location: new google.maps.LatLng(37.782842, -122.443688), weight: 1.5},
      {location: new google.maps.LatLng(37.782919, -122.442815), weight: 0.5},
      {location: new google.maps.LatLng(37.782992, -122.442112), weight: 0.5},
      {location: new google.maps.LatLng(37.783100, -122.441461), weight: 2.5},
      {location: new google.maps.LatLng(37.783206, -122.440829), weight: 0.5},
      {location: new google.maps.LatLng(37.783273, -122.440324), weight: 0.5},
      {location: new google.maps.LatLng(37.783316, -122.440023), weight: 1.5},
      {location: new google.maps.LatLng(37.783357, -122.439794), weight: 1.5},
      {location: new google.maps.LatLng(37.783371, -122.439687), weight: 1.5},
      {location: new google.maps.LatLng(37.783368, -122.439666), weight: 1.5},
      {location: new google.maps.LatLng(37.783383, -122.439594), weight: 1.5},
      {location: new google.maps.LatLng(37.783508, -122.439525), weight: 1.5},
      {location: new google.maps.LatLng(37.783842, -122.439591), weight: 1.5},
      {location: new google.maps.LatLng(37.784147, -122.439668), weight: 1.5},
      {location: new google.maps.LatLng(37.784206, -122.439686), weight: 1.5},
      {location: new google.maps.LatLng(37.784386, -122.439790), weight: 1.5},
      {location: new google.maps.LatLng(37.784701, -122.439902), weight: 1.5},
      {location: new google.maps.LatLng(37.784965, -122.439938), weight: 1.5},
      {location: new google.maps.LatLng(37.785010, -122.439947), weight: 1.5},
      {location: new google.maps.LatLng(37.785360, -122.439952), weight: 1.5},
      {location: new google.maps.LatLng(37.785715, -122.440030), weight: 1.5},
      {location: new google.maps.LatLng(37.786117, -122.440119), weight: 1.5},
      {location: new google.maps.LatLng(37.786564, -122.440209), weight: 1.5},
      {location: new google.maps.LatLng(37.786905, -122.440270), weight: 1.5},
      {location: new google.maps.LatLng(37.786956, -122.440279), weight: 1.5},
      {location: new google.maps.LatLng(37.800224, -122.433520), weight: 1.5},
      {location: new google.maps.LatLng(37.800155, -122.434101), weight: 1.5},
      {location: new google.maps.LatLng(37.800160, -122.434430), weight: 1.5},
      {location: new google.maps.LatLng(37.800378, -122.434527), weight: 1.5},
      {location: new google.maps.LatLng(37.800738, -122.434598), weight: 1.5},
      {location: new google.maps.LatLng(37.800938, -122.434650), weight: 1.5},
      {location: new google.maps.LatLng(37.801024, -122.434889), weight: 1.5},
      {location: new google.maps.LatLng(37.800955, -122.435392), weight: 1.5},
      {location: new google.maps.LatLng(37.800886, -122.435959), weight: 1.5},
      {location: new google.maps.LatLng(37.800811, -122.436275), weight: 1.5},
      {location: new google.maps.LatLng(37.800788, -122.436299), weight: 1.5},
      {location: new google.maps.LatLng(37.800719, -122.436302), weight: 1.5},
      {location: new google.maps.LatLng(37.800702, -122.436298), weight: 1.5},
      {location: new google.maps.LatLng(37.800661, -122.436273), weight: 1.5},
      {location: new google.maps.LatLng(37.800395, -122.436172), weight: 1.5},
      {location: new google.maps.LatLng(37.800228, -122.436116), weight: 1.5},
      {location: new google.maps.LatLng(37.800169, -122.436130), weight: 1.5},
      {location: new google.maps.LatLng(37.800066, -122.436167), weight: 1.5},
      {location: new google.maps.LatLng(37.784345, -122.422922), weight: 1.5},
      {location: new google.maps.LatLng(37.784389, -122.422926), weight: 1.5},
      {location: new google.maps.LatLng(37.784437, -122.422924), weight: 1.5},
      {location: new google.maps.LatLng(37.784746, -122.422818), weight: 1.5},
      {location: new google.maps.LatLng(37.785436, -122.422959), weight: 1.5},
      {location: new google.maps.LatLng(37.786120, -122.423112), weight: 1.5},
      {location: new google.maps.LatLng(37.786433, -122.423029), weight: 1.5},
      {location: new google.maps.LatLng(37.786631, -122.421213), weight: 1.5},
      {location: new google.maps.LatLng(37.786660, -122.421033), weight: 1.5},
      {location: new google.maps.LatLng(37.786801, -122.420141), weight: 1.5},
      {location: new google.maps.LatLng(37.786823, -122.420034), weight: 1.5},
      {location: new google.maps.LatLng(37.786831, -122.419916), weight: 1.5},
      {location: new google.maps.LatLng(37.787034, -122.418208), weight: 1.5},
      {location: new google.maps.LatLng(37.787056, -122.418034), weight: 1.5},
      {location: new google.maps.LatLng(37.787169, -122.417145), weight: 1.5},
      {location: new google.maps.LatLng(37.787217, -122.416715), weight: 1.5},
      {location: new google.maps.LatLng(37.786144, -122.416403), weight: 1.5},
      {location: new google.maps.LatLng(37.785292, -122.416257), weight: 1.5},
      {location: new google.maps.LatLng(37.780666, -122.390374), weight: 1.5},
      {location: new google.maps.LatLng(37.780501, -122.391281), weight: 1.5},
      {location: new google.maps.LatLng(37.780148, -122.392052), weight: 1.5},
      {location: new google.maps.LatLng(37.780173, -122.391148), weight: 1.5},
      {location: new google.maps.LatLng(37.780693, -122.390592), weight: 1.5},
      {location: new google.maps.LatLng(37.781261, -122.391142), weight: 1.5},
      {location: new google.maps.LatLng(37.781808, -122.391730), weight: 1.5},
      {location: new google.maps.LatLng(37.782340, -122.392341), weight: 1.5},
      {location: new google.maps.LatLng(37.782812, -122.393022), weight: 1.5},
      {location: new google.maps.LatLng(37.783300, -122.393672), weight: 1.5},
      {location: new google.maps.LatLng(37.783809, -122.394275), weight: 1.5},
      {location: new google.maps.LatLng(37.784246, -122.394979), weight: 1.5},
      {location: new google.maps.LatLng(37.784791, -122.395958), weight: 1.5},
      {location: new google.maps.LatLng(37.785675, -122.396746), weight: 1.5},
      {location: new google.maps.LatLng(37.786262, -122.395780), weight: 1.5},
      {location: new google.maps.LatLng(37.786776, -122.395093), weight: 1.5},
      {location: new google.maps.LatLng(37.787282, -122.394426), weight: 1.5},
      {location: new google.maps.LatLng(37.787783, -122.393767), weight: 1.5},
      {location: new google.maps.LatLng(37.788343, -122.393184), weight: 1.5},
      {location: new google.maps.LatLng(37.788895, -122.392506), weight: 1.5},
      {location: new google.maps.LatLng(37.789371, -122.391701), weight: 1.5},
      {location: new google.maps.LatLng(37.789722, -122.390952), weight: 1.5},
      {location: new google.maps.LatLng(37.790315, -122.390305), weight: 1.5},
      {location: new google.maps.LatLng(37.790738, -122.389616), weight: 1.5},
      {location: new google.maps.LatLng(37.779448, -122.438702), weight: 1.5},
      {location: new google.maps.LatLng(37.779023, -122.438585), weight: 1.5},
      {location: new google.maps.LatLng(37.778542, -122.438492), weight: 1.5},
      {location: new google.maps.LatLng(37.778100, -122.438411), weight: 1.5},
      {location: new google.maps.LatLng(37.777986, -122.438376), weight: 1.5},
      {location: new google.maps.LatLng(37.777680, -122.438313), weight: 1.5},
      {location: new google.maps.LatLng(37.777316, -122.438273), weight: 1.5},
      {location: new google.maps.LatLng(37.777135, -122.438254), weight: 1.5},
      {location: new google.maps.LatLng(37.776987, -122.438303), weight: 1.5},
      {location: new google.maps.LatLng(37.776946, -122.438404), weight: 1.5},
      {location: new google.maps.LatLng(37.776944, -122.438467), weight: 1.5},
      {location: new google.maps.LatLng(37.776892, -122.438459), weight: 1.5},
      {location: new google.maps.LatLng(37.776842, -122.438442), weight: 1.5},
      {location: new google.maps.LatLng(37.776822, -122.438391), weight: 1.5},
      {location: new google.maps.LatLng(37.776814, -122.438412), weight: 1.5},
      {location: new google.maps.LatLng(37.776787, -122.438628), weight: 1.5},
      {location: new google.maps.LatLng(37.776729, -122.438650), weight: 1.5},
      {location: new google.maps.LatLng(37.776759, -122.438677), weight: 1.5},
      {location: new google.maps.LatLng(37.776772, -122.438498), weight: 1.5},
      {location: new google.maps.LatLng(37.776787, -122.438389), weight: 1.5},
      {location: new google.maps.LatLng(37.776848, -122.438283), weight: 1.5},
      {location: new google.maps.LatLng(37.776870, -122.438239), weight: 1.5},
      {location: new google.maps.LatLng(37.777015, -122.438198), weight: 1.5},
      {location: new google.maps.LatLng(37.777333, -122.438256), weight: 1.5},
      {location: new google.maps.LatLng(37.777595, -122.438308), weight: 1.5},
      {location: new google.maps.LatLng(37.777797, -122.438344), weight: 1.5},
      {location: new google.maps.LatLng(37.778160, -122.438442), weight: 1.5},
      {location: new google.maps.LatLng(37.778414, -122.438508), weight: 1.5},
      {location: new google.maps.LatLng(37.778445, -122.438516), weight: 1.5},
      {location: new google.maps.LatLng(37.778503, -122.438529), weight: 1.5},
      {location: new google.maps.LatLng(37.778607, -122.438549), weight: 1.5},
      {location: new google.maps.LatLng(37.778670, -122.438644), weight: 1.5},
      {location: new google.maps.LatLng(37.778847, -122.438706), weight: 1.5},
      {location: new google.maps.LatLng(37.779240, -122.438744), weight: 1.5},
      {location: new google.maps.LatLng(37.779738, -122.438822), weight: 1.5},
      {location: new google.maps.LatLng(37.780201, -122.438882), weight: 1.5},
      {location: new google.maps.LatLng(37.780400, -122.438905), weight: 1.5},
      {location: new google.maps.LatLng(37.780501, -122.438921), weight: 1.5},
      {location: new google.maps.LatLng(37.780892, -122.438986), weight: 1.5},
      {location: new google.maps.LatLng(37.781446, -122.439087), weight: 1.5},
      {location: new google.maps.LatLng(37.781985, -122.439199), weight: 1.5},
      {location: new google.maps.LatLng(37.782239, -122.439249), weight: 1.5},
      {location: new google.maps.LatLng(37.782286, -122.439266), weight: 1.5},
      {location: new google.maps.LatLng(37.797847, -122.429388), weight: 1.5},
      {location: new google.maps.LatLng(37.797874, -122.429180), weight: 1.5},
      {location: new google.maps.LatLng(37.797885, -122.429069), weight: 1.5},
      {location: new google.maps.LatLng(37.797887, -122.429050), weight: 1.5},
      {location: new google.maps.LatLng(37.797933, -122.428954), weight: 1.5},
      {location: new google.maps.LatLng(37.798242, -122.428990), weight: 1.5},
      {location: new google.maps.LatLng(37.798617, -122.429075), weight: 1.5},
      {location: new google.maps.LatLng(37.798719, -122.429092), weight: 1.5},
      {location: new google.maps.LatLng(37.798944, -122.429145), weight: 1.5},
      {location: new google.maps.LatLng(37.799320, -122.429251), weight: 1.5},
      {location: new google.maps.LatLng(37.799590, -122.429309), weight: 1.5},
      {location: new google.maps.LatLng(37.799677, -122.429324), weight: 1.5},
      {location: new google.maps.LatLng(37.799966, -122.429360), weight: 1.5},
      {location: new google.maps.LatLng(37.800288, -122.429430), weight: 1.5},
      {location: new google.maps.LatLng(37.800443, -122.429461), weight: 1.5},
      {location: new google.maps.LatLng(37.800465, -122.429474), weight: 1.5},
      {location: new google.maps.LatLng(37.800644, -122.429540), weight: 1.5},
      {location: new google.maps.LatLng(37.800948, -122.429620), weight: 1.5},
      {location: new google.maps.LatLng(37.801242, -122.429685), weight: 1.5},
      {location: new google.maps.LatLng(37.801375, -122.429702), weight: 1.5},
      {location: new google.maps.LatLng(37.801400, -122.429703), weight: 1.5},
      {location: new google.maps.LatLng(37.801453, -122.429707), weight: 1.5},
      {location: new google.maps.LatLng(37.801473, -122.429709), weight: 1.5},
      {location: new google.maps.LatLng(37.801532, -122.429707), weight: 1.5},
      {location: new google.maps.LatLng(37.801852, -122.429729), weight: 1.5},
      {location: new google.maps.LatLng(37.802173, -122.429789), weight: 1.5},
      {location: new google.maps.LatLng(37.802459, -122.429847), weight: 1.5},
      {location: new google.maps.LatLng(37.802554, -122.429825), weight: 1.5},
      {location: new google.maps.LatLng(37.802647, -122.429549), weight: 1.5},
      {location: new google.maps.LatLng(37.802693, -122.429179), weight: 1.5},
      {location: new google.maps.LatLng(37.802729, -122.428751), weight: 1.5},
      {location: new google.maps.LatLng(37.766104, -122.409291), weight: 1.5},
      {location: new google.maps.LatLng(37.766103, -122.409268), weight: 1.5},
      {location: new google.maps.LatLng(37.766138, -122.409229), weight: 1.5},
      {location: new google.maps.LatLng(37.766183, -122.409231), weight: 1.5},
      {location: new google.maps.LatLng(37.766153, -122.409276), weight: 1.5},
      {location: new google.maps.LatLng(37.766005, -122.409365), weight: 1.5},
      {location: new google.maps.LatLng(37.765897, -122.409570), weight: 1.5},
      {location: new google.maps.LatLng(37.765767, -122.409739), weight: 1.5},
      {location: new google.maps.LatLng(37.765693, -122.410389), weight: 1.5},
      {location: new google.maps.LatLng(37.765615, -122.411201), weight: 1.5},
      {location: new google.maps.LatLng(37.765533, -122.412121), weight: 1.5},
      {location: new google.maps.LatLng(37.765467, -122.412939), weight: 1.5},
      {location: new google.maps.LatLng(37.765444, -122.414821), weight: 1.5},
      {location: new google.maps.LatLng(37.765444, -122.414964), weight: 1.5},
      {location: new google.maps.LatLng(37.765318, -122.415424), weight: 1.5},
      {location: new google.maps.LatLng(37.763961, -122.415296), weight: 1.5},
      {location: new google.maps.LatLng(37.763115, -122.415196), weight: 1.5},
      {location: new google.maps.LatLng(37.762967, -122.415183), weight: 1.5},
      {location: new google.maps.LatLng(37.762278, -122.415127), weight: 1.5},
      {location: new google.maps.LatLng(37.761675, -122.415055), weight: 1.5},
      {location: new google.maps.LatLng(37.760932, -122.414988), weight: 1.5},
      {location: new google.maps.LatLng(37.759337, -122.414862), weight: 1.5},
      {location: new google.maps.LatLng(37.773187, -122.421922), weight: 1.5},
      {location: new google.maps.LatLng(37.773043, -122.422118), weight: 1.5},
      {location: new google.maps.LatLng(37.773007, -122.422165), weight: 1.5},
      {location: new google.maps.LatLng(37.772979, -122.422219), weight: 1.5},
      {location: new google.maps.LatLng(37.772865, -122.422394), weight: 1.5},
      {location: new google.maps.LatLng(37.772779, -122.422503), weight: 1.5},
      {location: new google.maps.LatLng(37.772676, -122.422701), weight: 1.5},
      {location: new google.maps.LatLng(37.772606, -122.422806), weight: 1.5},
      {location: new google.maps.LatLng(37.772566, -122.422840), weight: 1.5},
      {location: new google.maps.LatLng(37.772508, -122.422852), weight: 1.5},
      {location: new google.maps.LatLng(37.772387, -122.423011), weight: 1.5},
      {location: new google.maps.LatLng(37.772099, -122.423328), weight: 1.5},
      {location: new google.maps.LatLng(37.771704, -122.423783), weight: 1.5},
      {location: new google.maps.LatLng(37.771481, -122.424081), weight: 1.5},
      {location: new google.maps.LatLng(37.771400, -122.424179), weight: 1.5},
      {location: new google.maps.LatLng(37.771352, -122.424220), weight: 1.5},
      {location: new google.maps.LatLng(37.771248, -122.424327), weight: 1.5},
      {location: new google.maps.LatLng(37.770904, -122.424781), weight: 1.5},
      {location: new google.maps.LatLng(37.770520, -122.425283), weight: 1.5},
      {location: new google.maps.LatLng(37.770337, -122.425553), weight: 1.5},
      {location: new google.maps.LatLng(37.770128, -122.425832), weight: 1.5},
      {location: new google.maps.LatLng(37.769756, -122.426331), weight: 1.5},
      {location: new google.maps.LatLng(37.769300, -122.426902), weight: 1.5},
      {location: new google.maps.LatLng(37.769132, -122.427065), weight: 1.5},
      {location: new google.maps.LatLng(37.769092, -122.427103), weight: 1.5},
      {location: new google.maps.LatLng(37.768979, -122.427172), weight: 1.5},
      {location: new google.maps.LatLng(37.768595, -122.427634), weight: 1.5},
      {location: new google.maps.LatLng(37.768372, -122.427913), weight: 1.5},
      {location: new google.maps.LatLng(37.768337, -122.427961), weight: 1.5},
      {location: new google.maps.LatLng(37.768244, -122.428138), weight: 1.5},
      {location: new google.maps.LatLng(37.767942, -122.428581), weight: 1.5},
      {location: new google.maps.LatLng(37.767482, -122.429094), weight: 1.5},
      {location: new google.maps.LatLng(37.767031, -122.429606), weight: 1.5},
      {location: new google.maps.LatLng(37.766732, -122.429986), weight: 1.5},
      {location: new google.maps.LatLng(37.766680, -122.430058), weight: 1.5},
      {location: new google.maps.LatLng(37.766633, -122.430109), weight: 1.5},
      {location: new google.maps.LatLng(37.766580, -122.430211), weight: 1.5},
      {location: new google.maps.LatLng(37.766367, -122.430594), weight: 1.5},
      {location: new google.maps.LatLng(37.765910, -122.431137), weight: 1.5},
      {location: new google.maps.LatLng(37.765353, -122.431806), weight: 1.5},
      {location: new google.maps.LatLng(37.764962, -122.432298), weight: 1.5},
      {location: new google.maps.LatLng(37.764868, -122.432486), weight: 1.5},
      {location: new google.maps.LatLng(37.764518, -122.432913), weight: 1.5},
      {location: new google.maps.LatLng(37.763435, -122.434173), weight: 1.5},
      {location: new google.maps.LatLng(37.762847, -122.434953), weight: 1.5},
      {location: new google.maps.LatLng(37.762291, -122.435935), weight: 1.5},
      {location: new google.maps.LatLng(37.762224, -122.436074), weight: 1.5},
      {location: new google.maps.LatLng(37.761957, -122.436892), weight: 1.5},
      {location: new google.maps.LatLng(37.761652, -122.438886), weight: 1.5},
      {location: new google.maps.LatLng(37.761284, -122.439955), weight: 1.5},
      {location: new google.maps.LatLng(37.761210, -122.440068), weight: 1.5},
      {location: new google.maps.LatLng(37.761064, -122.440720), weight: 1.5},
      {location: new google.maps.LatLng(37.761040, -122.441411), weight: 1.5},
      {location: new google.maps.LatLng(37.761048, -122.442324), weight: 1.5},
      {location: new google.maps.LatLng(37.760851, -122.443118), weight: 1.5},
      {location: new google.maps.LatLng(37.759977, -122.444591), weight: 1.5},
      {location: new google.maps.LatLng(37.759913, -122.444698), weight: 1.5},
      {location: new google.maps.LatLng(37.759623, -122.445065), weight: 1.5},
      {location: new google.maps.LatLng(37.758902, -122.445158), weight: 1.5},
      {location: new google.maps.LatLng(37.758428, -122.444570), weight: 1.5},
      {location: new google.maps.LatLng(37.757687, -122.443340), weight: 1.5},
      {location: new google.maps.LatLng(37.757583, -122.443240), weight: 1.5},
      {location: new google.maps.LatLng(37.757019, -122.442787), weight: 1.5},
      {location: new google.maps.LatLng(37.756603, -122.442322), weight: 1.5},
      {location: new google.maps.LatLng(37.756380, -122.441602), weight: 1.5},
      {location: new google.maps.LatLng(37.755790, -122.441382), weight: 1.5},
      {location: new google.maps.LatLng(37.754493, -122.442133), weight: 1.5},
      {location: new google.maps.LatLng(37.754361, -122.442206), weight: 1.5},
      {location: new google.maps.LatLng(37.753719, -122.442650), weight: 1.5},
      {location: new google.maps.LatLng(37.753096, -122.442915), weight: 1.5},
      {location: new google.maps.LatLng(37.751617, -122.443211), weight: 1.5},
      {location: new google.maps.LatLng(37.751496, -122.443246), weight: 1.5},
      {location: new google.maps.LatLng(37.750733, -122.443428), weight: 1.5},
      {location: new google.maps.LatLng(37.750126, -122.443536), weight: 1.5},
      {location: new google.maps.LatLng(37.750103, -122.443784), weight: 1.5},
      {location: new google.maps.LatLng(37.750390, -122.444010), weight: 1.5},
      {location: new google.maps.LatLng(37.750448, -122.444013), weight: 1.5},
      {location: new google.maps.LatLng(37.750536, -122.444040), weight: 1.5},
      {location: new google.maps.LatLng(37.750493, -122.444141), weight: 1.5},
      {location: new google.maps.LatLng(37.790859, -122.402808), weight: 1.5},
      {location: new google.maps.LatLng(37.790864, -122.402768), weight: 1.5},
      {location: new google.maps.LatLng(37.790995, -122.402539), weight: 1.5},
      {location: new google.maps.LatLng(37.791148, -122.402172), weight: 1.5},
      {location: new google.maps.LatLng(37.791385, -122.401312), weight: 1.5},
      {location: new google.maps.LatLng(37.791405, -122.400776), weight: 1.5},
      {location: new google.maps.LatLng(37.791288, -122.400528), weight: 1.5},
      {location: new google.maps.LatLng(37.791113, -122.400441), weight: 1.5},
      {location: new google.maps.LatLng(37.791027, -122.400395), weight: 1.5},
      {location: new google.maps.LatLng(37.791094, -122.400311), weight: 1.5},
      {location: new google.maps.LatLng(37.791211, -122.400183), weight: 1.5},
      {location: new google.maps.LatLng(37.791060, -122.399334), weight: 1.5},
      {location: new google.maps.LatLng(37.790538, -122.398718), weight: 1.5},
      {location: new google.maps.LatLng(37.790095, -122.398086), weight: 1.5},
      {location: new google.maps.LatLng(37.789644, -122.397360), weight: 1.5},
      {location: new google.maps.LatLng(37.789254, -122.396844), weight: 1.5},
      {location: new google.maps.LatLng(37.788855, -122.396397), weight: 1.5},
      {location: new google.maps.LatLng(37.788483, -122.395963), weight: 1.5},
      {location: new google.maps.LatLng(37.788015, -122.395365), weight: 1.5},
      {location: new google.maps.LatLng(37.787558, -122.394735), weight: 1.5},
      {location: new google.maps.LatLng(37.787472, -122.394323), weight: 1.5},
      {location: new google.maps.LatLng(37.787630, -122.394025), weight: 1.5},
      {location: new google.maps.LatLng(37.787767, -122.393987), weight: 1.5},
      {location: new google.maps.LatLng(37.787486, -122.394452), weight: 1.5},
      {location: new google.maps.LatLng(37.786977, -122.395043), weight: 1.5},
      {location: new google.maps.LatLng(37.786583, -122.395552), weight: 1.5},
      {location: new google.maps.LatLng(37.786540, -122.395610), weight: 1.5},
      {location: new google.maps.LatLng(37.786516, -122.395659), weight: 1.5},
      {location: new google.maps.LatLng(37.786378, -122.395707), weight: 1.5},
      {location: new google.maps.LatLng(37.786044, -122.395362), weight: 1.5},
      {location: new google.maps.LatLng(37.785598, -122.394715), weight: 1.5},
      {location: new google.maps.LatLng(37.785321, -122.394361), weight: 1.5},
      {location: new google.maps.LatLng(37.785207, -122.394236), weight: 1.5},
      {location: new google.maps.LatLng(37.785751, -122.394062), weight: 1.5},
      {location: new google.maps.LatLng(37.785996, -122.393881), weight: 1.5},
      {location: new google.maps.LatLng(37.786092, -122.393830), weight: 1.5},
      {location: new google.maps.LatLng(37.785998, -122.393899), weight: 1.5},
      {location: new google.maps.LatLng(37.785114, -122.394365), weight: 1.5},
      {location: new google.maps.LatLng(37.785022, -122.394441), weight: 1.5},
      {location: new google.maps.LatLng(37.784823, -122.394635), weight: 1.5},
      {location: new google.maps.LatLng(37.784719, -122.394629), weight: 1.5},
      {location: new google.maps.LatLng(37.785069, -122.394176), weight: 1.5},
      {location: new google.maps.LatLng(37.785500, -122.393650), weight: 1.5},
      {location: new google.maps.LatLng(37.785770, -122.393291), weight: 1.5},
      {location: new google.maps.LatLng(37.785839, -122.393159), weight: 1.5},
      {location: new google.maps.LatLng(37.782651, -122.400628), weight: 1.5},
      {location: new google.maps.LatLng(37.782616, -122.400599), weight: 1.5},
      {location: new google.maps.LatLng(37.782702, -122.400470), weight: 1.5},
      {location: new google.maps.LatLng(37.782915, -122.400192), weight: 1.5},
      {location: new google.maps.LatLng(37.783137, -122.399887), weight: 1.5},
      {location: new google.maps.LatLng(37.783414, -122.399519), weight: 1.5},
      {location: new google.maps.LatLng(37.783629, -122.399237), weight: 1.5},
      {location: new google.maps.LatLng(37.783688, -122.399157), weight: 1.5},
      {location: new google.maps.LatLng(37.783716, -122.399106), weight: 1.5},
      {location: new google.maps.LatLng(37.783798, -122.399072), weight: 1.5},
      {location: new google.maps.LatLng(37.783997, -122.399186), weight: 1.5},
      {location: new google.maps.LatLng(37.784271, -122.399538), weight: 1.5},
      {location: new google.maps.LatLng(37.784577, -122.399948), weight: 1.5},
      {location: new google.maps.LatLng(37.784828, -122.400260), weight: 1.5},
      {location: new google.maps.LatLng(37.784999, -122.400477), weight: 1.5},
      {location: new google.maps.LatLng(37.785113, -122.400651), weight: 1.5},
      {location: new google.maps.LatLng(37.785155, -122.400703), weight: 1.5},
      {location: new google.maps.LatLng(37.785192, -122.400749), weight: 1.5},
      {location: new google.maps.LatLng(37.785278, -122.400839), weight: 1.5},
      {location: new google.maps.LatLng(37.785387, -122.400857), weight: 1.5},
      {location: new google.maps.LatLng(37.785478, -122.400890), weight: 1.5},
      {location: new google.maps.LatLng(37.785526, -122.401022), weight: 1.5},
      {location: new google.maps.LatLng(37.785598, -122.401148), weight: 1.5},
      {location: new google.maps.LatLng(37.785631, -122.401202), weight: 1.5},
      {location: new google.maps.LatLng(37.785660, -122.401267), weight: 1.5},
      {location: new google.maps.LatLng(37.803986, -122.426035), weight: 1.5},
      {location: new google.maps.LatLng(37.804102, -122.425089), weight: 1.5},
      {location: new google.maps.LatLng(37.804211, -122.424156), weight: 1.5},
      {location: new google.maps.LatLng(37.803861, -122.423385), weight: 1.5},
      {location: new google.maps.LatLng(37.803151, -122.423214), weight: 1.5},
      {location: new google.maps.LatLng(37.802439, -122.423077), weight: 1.5},
      {location: new google.maps.LatLng(37.801740, -122.422905), weight: 1.5},
      {location: new google.maps.LatLng(37.801069, -122.422785), weight: 1.5},
      {location: new google.maps.LatLng(37.800345, -122.422649), weight: 1.5},
      {location: new google.maps.LatLng(37.799633, -122.422603), weight: 1.5},
      {location: new google.maps.LatLng(37.799750, -122.421700), weight: 1.5},
      {location: new google.maps.LatLng(37.799885, -122.420854), weight: 1.5},
      {location: new google.maps.LatLng(37.799209, -122.420607), weight: 1.5},
      {location: new google.maps.LatLng(37.795656, -122.400395), weight: 1.5},
      {location: new google.maps.LatLng(37.795203, -122.400304), weight: 1.5},
      {location: new google.maps.LatLng(37.778738, -122.415584), weight: 1.5},
      {location: new google.maps.LatLng(37.778812, -122.415189), weight: 1.5},
      {location: new google.maps.LatLng(37.778824, -122.415092), weight: 1.5},
      {location: new google.maps.LatLng(37.778833, -122.414932), weight: 1.5},
      {location: new google.maps.LatLng(37.778834, -122.414898), weight: 1.5},
      {location: new google.maps.LatLng(37.778740, -122.414757), weight: 1.5},
      {location: new google.maps.LatLng(37.778501, -122.414433), weight: 1.5},
      {location: new google.maps.LatLng(37.778182, -122.414026), weight: 1.5},
      {location: new google.maps.LatLng(37.777851, -122.413623), weight: 1.5},
      {location: new google.maps.LatLng(37.777486, -122.413166), weight: 1.5},
      {location: new google.maps.LatLng(37.777109, -122.412674), weight: 1.5},
      {location: new google.maps.LatLng(37.776743, -122.412186), weight: 1.5},
      {location: new google.maps.LatLng(37.776440, -122.411800), weight: 1.5},
      {location: new google.maps.LatLng(37.776295, -122.411614), weight: 1.5},
      {location: new google.maps.LatLng(37.776158, -122.411440), weight: 1.5},
      {location: new google.maps.LatLng(37.775806, -122.410997), weight: 1.5},
      {location: new google.maps.LatLng(37.775422, -122.410484), weight: 1.5},
      {location: new google.maps.LatLng(37.775126, -122.410087), weight: 1.5},
      {location: new google.maps.LatLng(37.775012, -122.409854), weight: 1.5},
      {location: new google.maps.LatLng(37.775164, -122.409573), weight: 1.5},
      {location: new google.maps.LatLng(37.775498, -122.409180), weight: 1.5},
      {location: new google.maps.LatLng(37.775868, -122.408730), weight: 1.5},
      {location: new google.maps.LatLng(37.776256, -122.408240), weight: 1.5},
      {location: new google.maps.LatLng(37.776519, -122.407928), weight: 1.5},
      {location: new google.maps.LatLng(37.776539, -122.407904), weight: 1.5},
      {location: new google.maps.LatLng(37.776595, -122.407854), weight: 1.5},
      {location: new google.maps.LatLng(37.776853, -122.407547), weight: 1.5},
      {location: new google.maps.LatLng(37.777234, -122.407087), weight: 1.5},
      {location: new google.maps.LatLng(37.777644, -122.406558), weight: 1.5},
      {location: new google.maps.LatLng(37.778066, -122.406017), weight: 1.5},
      {location: new google.maps.LatLng(37.778468, -122.405499), weight: 1.5},
      {location: new google.maps.LatLng(37.778866, -122.404995), weight: 1.5},
      {location: new google.maps.LatLng(37.779295, -122.404455), weight: 1.5},
      {location: new google.maps.LatLng(37.779695, -122.403950), weight: 1.5},
      {location: new google.maps.LatLng(37.779982, -122.403584), weight: 1.5},
      {location: new google.maps.LatLng(37.780295, -122.403223), weight: 1.5},
      {location: new google.maps.LatLng(37.780664, -122.402766), weight: 1.5},
      {location: new google.maps.LatLng(37.781043, -122.402288), weight: 1.5},
      {location: new google.maps.LatLng(37.781399, -122.401823), weight: 1.5},
      {location: new google.maps.LatLng(37.781727, -122.401407), weight: 1.5},
      {location: new google.maps.LatLng(37.781853, -122.401247), weight: 1.5},
      {location: new google.maps.LatLng(37.781894, -122.401195), weight: 1.5},
      {location: new google.maps.LatLng(37.782076, -122.400977), weight: 1.5},
      {location: new google.maps.LatLng(37.782338, -122.400603), weight: 1.5},
      {location: new google.maps.LatLng(37.782666, -122.400133), weight: 1.5},
      {location: new google.maps.LatLng(37.783048, -122.399634), weight: 1.5},
      {location: new google.maps.LatLng(37.783450, -122.399198), weight: 1.5},
      {location: new google.maps.LatLng(37.783791, -122.398998), weight: 1.5},
      {location: new google.maps.LatLng(37.784177, -122.398959), weight: 1.5},
      {location: new google.maps.LatLng(37.784388, -122.398971), weight: 1.5},
      {location: new google.maps.LatLng(37.784404, -122.399128), weight: 1.5},
      {location: new google.maps.LatLng(37.784586, -122.399524), weight: 1.5},
      {location: new google.maps.LatLng(37.784835, -122.399927), weight: 1.5},
      {location: new google.maps.LatLng(37.785116, -122.400307), weight: 1.5},
      {location: new google.maps.LatLng(37.785282, -122.400539), weight: 1.5},
      {location: new google.maps.LatLng(37.785346, -122.400692), weight: 1.5},
      {location: new google.maps.LatLng(37.765769, -122.407201), weight: 1.5},
      {location: new google.maps.LatLng(37.765790, -122.407414), weight: 1.5},
      {location: new google.maps.LatLng(37.765802, -122.407755), weight: 2.5},
      {location: new google.maps.LatLng(37.765791, -122.408219), weight: 2.5},
      {location: new google.maps.LatLng(37.765763, -122.408759), weight: 2.5},
      {location: new google.maps.LatLng(37.765726, -122.409348), weight: 2.5},
      {location: new google.maps.LatLng(37.765716, -122.409882), weight: 2.5},
      {location: new google.maps.LatLng(37.765708, -122.410202), weight: 2.5},
      {location: new google.maps.LatLng(37.765705, -122.410253), weight: 2.5},
      {location: new google.maps.LatLng(37.765707, -122.410369), weight: 2.5},
      {location: new google.maps.LatLng(37.765692, -122.410720), weight: 2.5},
      {location: new google.maps.LatLng(37.765699, -122.411215), weight: 2.5},
      {location: new google.maps.LatLng(37.765687, -122.411789), weight: 2.5},
      {location: new google.maps.LatLng(37.765666, -122.412373), weight: 2.5},
      {location: new google.maps.LatLng(37.765598, -122.412883), weight: 2.5},
      {location: new google.maps.LatLng(37.765543, -122.413039), weight: 2.5},
      {location: new google.maps.LatLng(37.765532, -122.413125), weight: 2.5},
      {location: new google.maps.LatLng(37.765500, -122.413553), weight: 2.5},
      {location: new google.maps.LatLng(37.765448, -122.414053), weight: 2.5},
      {location: new google.maps.LatLng(37.765388, -122.414645), weight: 2.5},
      {location: new google.maps.LatLng(37.765323, -122.415250), weight: 2.5},
      {location: new google.maps.LatLng(37.765303, -122.415847), weight: 2.5},
      {location: new google.maps.LatLng(37.765251, -122.416439), weight: 2.5},
      {location: new google.maps.LatLng(37.765204, -122.417020), weight: 2.5},
      {location: new google.maps.LatLng(37.765172, -122.417556), weight: 2.5},
      {location: new google.maps.LatLng(37.765164, -122.418075), weight: 2.5},
      {location: new google.maps.LatLng(37.765153, -122.418618), weight: 2.5},
      {location: new google.maps.LatLng(37.765136, -122.419112), weight: 2.5},
      {location: new google.maps.LatLng(37.765129, -122.419378), weight: 1.5},
      {location: new google.maps.LatLng(37.765119, -122.419481), weight: 1.5},
      {location: new google.maps.LatLng(37.765100, -122.419852), weight: 1.5},
      {location: new google.maps.LatLng(37.765083, -122.420349), weight: 1.5},
      {location: new google.maps.LatLng(37.765045, -122.420930), weight: 1.5},
      {location: new google.maps.LatLng(37.764992, -122.421481), weight: 1.5},
      {location: new google.maps.LatLng(37.764980, -122.421695), weight: 1.5},
      {location: new google.maps.LatLng(37.764993, -122.421843), weight: 1.5},
      {location: new google.maps.LatLng(37.764986, -122.422255), weight: 1.5},
      {location: new google.maps.LatLng(37.764975, -122.422823), weight: 1.5},
      {location: new google.maps.LatLng(37.764939, -122.423411), weight: 1.5},
      {location: new google.maps.LatLng(37.764902, -122.424014), weight: 1.5},
      {location: new google.maps.LatLng(37.764853, -122.424576), weight: 1.5},
      {location: new google.maps.LatLng(37.764826, -122.424922), weight: 1.5},
      {location: new google.maps.LatLng(37.764796, -122.425375), weight: 1.5},
      {location: new google.maps.LatLng(37.764782, -122.425869), weight: 1.5},
      {location: new google.maps.LatLng(37.764768, -122.426089), weight: 3.5},
      {location: new google.maps.LatLng(37.764766, -122.426117), weight: 3.5},
      {location: new google.maps.LatLng(37.764723, -122.426276), weight: 3.5},
      {location: new google.maps.LatLng(37.764681, -122.426649), weight: 3.5},
      {location: new google.maps.LatLng(37.782012, -122.404200), weight: 3.5},
      {location: new google.maps.LatLng(37.781574, -122.404911), weight: 3.5},
      {location: new google.maps.LatLng(37.781055, -122.405597), weight: 3.5},
      {location: new google.maps.LatLng(37.780479, -122.406341), weight: 3.5},
      {location: new google.maps.LatLng(37.779996, -122.406939), weight: 3.5},
      {location: new google.maps.LatLng(37.779459, -122.407613), weight: 3.5},
      {location: new google.maps.LatLng(37.778953, -122.408228), weight: 3.5},
      {location: new google.maps.LatLng(37.778409, -122.408839), weight: 3.5},
      {location: new google.maps.LatLng(37.777842, -122.409501), weight: 3.5},
      {location: new google.maps.LatLng(37.777334, -122.410181), weight: 3.5},
      {location: new google.maps.LatLng(37.776809, -122.410836), weight: 3.5},
      {location: new google.maps.LatLng(37.776240, -122.411514), weight: 1.5},
      {location: new google.maps.LatLng(37.775725, -122.412145), weight: 1.5},
      {location: new google.maps.LatLng(37.775190, -122.412805), weight: 1.5},
      {location: new google.maps.LatLng(37.774672, -122.413464), weight: 1.5},
      {location: new google.maps.LatLng(37.774084, -122.414186), weight: 1.5},
      {location: new google.maps.LatLng(37.773533, -122.413636), weight: 1.5},
      {location: new google.maps.LatLng(37.773021, -122.413009), weight: 1.5},
      {location: new google.maps.LatLng(37.772501, -122.412371), weight: 1.5},
      {location: new google.maps.LatLng(37.771964, -122.411681), weight: 1.5},
      {location: new google.maps.LatLng(37.771479, -122.411078), weight: 1.5},
      {location: new google.maps.LatLng(37.770992, -122.410477), weight: 1.5},
      {location: new google.maps.LatLng(37.770467, -122.409801), weight: 1.5},
      {location: new google.maps.LatLng(37.770090, -122.408904), weight: 1.5},
      {location: new google.maps.LatLng(37.769657, -122.408103), weight: 1.5},
      {location: new google.maps.LatLng(37.769132, -122.407276), weight: 1.5},
      {location: new google.maps.LatLng(37.768564, -122.406469), weight: 1.5},
      {location: new google.maps.LatLng(37.767980, -122.405745), weight: 1.5},
      {location: new google.maps.LatLng(37.767380, -122.405299), weight: 1.5},
      {location: new google.maps.LatLng(37.766604, -122.405297), weight: 1.5},
      {location: new google.maps.LatLng(37.765838, -122.405200), weight: 1.5},
      {location: new google.maps.LatLng(37.765139, -122.405139), weight: 1.5},
      {location: new google.maps.LatLng(37.764457, -122.405094), weight: 1.5},
      {location: new google.maps.LatLng(37.763716, -122.405142), weight: 1.5},
      {location: new google.maps.LatLng(37.762932, -122.405398), weight: 1.5},
      {location: new google.maps.LatLng(37.762126, -122.405813), weight: 1.5},
      {location: new google.maps.LatLng(37.761344, -122.406215), weight: 1.5},
      {location: new google.maps.LatLng(37.760556, -122.406495), weight: 1.5},
      {location: new google.maps.LatLng(37.759732, -122.406484), weight: 1.5},
      {location: new google.maps.LatLng(37.758910, -122.406228), weight: 1.5},
      {location: new google.maps.LatLng(37.758182, -122.405695), weight: 1.5},
      {location: new google.maps.LatLng(37.757676, -122.405118), weight: 1.5},
      {location: new google.maps.LatLng(37.757039, -122.404346), weight: 1.5},
      {location: new google.maps.LatLng(37.756335, -122.403719), weight: 1.5},
      {location: new google.maps.LatLng(37.755503, -122.403406), weight: 1.5},
      {location: new google.maps.LatLng(37.754665, -122.403242), weight: 1.5},
      {location: new google.maps.LatLng(37.753837, -122.403172), weight: 1.5},
      {location: new google.maps.LatLng(37.752986, -122.403112), weight: 1.5},
      {location: new google.maps.LatLng(37.751266, -122.403355), weight: 1.5}
    ]};

    this.addPoint = function(stacheID, lat, lon, dist) {
      var weight = this.weight(dist) * 5;
      var newPoint = {
        location: new google.maps.LatLng(lat, lon),
        weight: weight
      };

      var key = lat.toFixed(5) + ", " + lon.toFixed(5);

      if (dataPoints.hasOwnProperty(stacheID)) {
        dataPoints[stacheID].push(newPoint);
        visited[stacheID][key] = true;
      } else {
        dataPoints[stacheID] = [newPoint];
        visited[stacheID] = { key: true };
      }
      return newPoint;
    };

    this.getPoints = function(stacheID) {
      return dataPoints[stacheID];
    };

    this.contains = function(stacheID, lat, lon) {
      // Truncate lat and lon to 5 decimel places
      // (results in precision of 1 meter)
      var key = lat.toFixed(5) + ", " + lon.toFixed(5);
      return visited[stacheID][key] ? true : false;
    };

    this.weight = function(distance) {
      // The closer the user is to the stache, the greater the weight
      // Weight is normalized by max distance
      var maxDistance = 500; // meters

      // Cap distance to maxDistance
      // (color indicator changes colors within range of 8000 meters/5 miles)
      if (distance > maxDistance) {
            distance = maxDistance;
      }

      var weight = (maxDistance - distance) / maxDistance;
      return weight;
    };

    this.color = function(dist) {
      var weight = this.weight(dist);
      var r = weight > 0.75 ? Math.ceil(weight * 255) : 0;
      var g = weight < 0.25 ? Math.ceil((1 - weight) * 255) : 0;
      var b = Math.ceil((1 - weight) * 255);
      return 'rgba(' + r + ', ' + g + ', ' + b + ', 1)';
    };

  };

  angular.module('specter').service('heatmapService', heatmapService);
})();
